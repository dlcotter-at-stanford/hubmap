<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
  </head>
  <body>
    <canvas id='myCanvas' width='1500' height='600' style='border:2px solid black;  margin-left: 250px'>Your browser does not support the canvas element.</canvas>

    <div id='sidebar'>
      Tissue Type<br/>
        <input type='checkbox' name='tissue_type' id='tissue_type_normal' value='normal' checked='true'><label for='tissue_type_normal'>Normal</label><br/>
        <input type='checkbox' name='tissue_type' id='tissue_type_polyp' value='polyp' checked='true'><label for='tissue_type_polyp'>Polyp</label><br/>
        <input type='checkbox' name='tissue_type' id='tissue_type_adca' value='adca' checked='true'><label for='tissue_type_adca'>AdCa</label><br/>
      <br/>

      Size<br/>
        <input type='checkbox' name='size' id='size_small' value='small' checked='true'><label for='size_small'>Small</label><br/>
        <input type='checkbox' name='size' id='size_medium' value='medium' checked='true'><label for='size_medium'>Medium</label><br/>
        <input type='checkbox' name='size' id='size_large' value='large' checked='true'><label for='size_large'>Large</label><br/>
      <br/>

      Phenotype<br/>
        <input type='checkbox' name='phenotype' id='phenotype_normal' value='normal' checked='true'><label for='phenotype_normal'>Normal</label><br/>
        <input type='checkbox' name='phenotype' id='phenotype_sessile' value='sessile' checked='true'><label for='phenotype_sessile'>Sessile</label><br/>
        <input type='checkbox' name='phenotype' id='phenotype_stalk' value='stalk' checked='true'><label for='phenotype_stalk'>Stalk</label><br/>
      <br/>

      Location<br/>
        <input type='checkbox' name='location' id='location_ascending' value='ascending' checked='true'><label for='location_ascending'>Ascending</label><br/>
        <input type='checkbox' name='location' id='location_transverse' value='transverse' checked='true'><label for='location_transverse'>Transverse</label><br/>
        <input type='checkbox' name='location' id='location_descending' value='descending' checked='true'><label for='location_descending'>Descending</label><br/>
        <input type='checkbox' name='location' id='location_rectum' value='rectum' checked='true'><label for='location_rectum'>Rectum</label><br/>
      <br/>
    </div>

    <style>
      body { font-family: Arial, Helvetica, sans-serif; }

      /* The sidebar menu */
      #sidebar {
        height: 100%; /* Full-height: remove this if you want "auto" height */
        width: 240px; /* Set the width of the sidebar */
        position: fixed; /* Fixed Sidebar (stay in place on scroll) */
        z-index: 1; /* Stay on top */
        top: 0; /* Stay at the top */
        left: 0;
        background-color: gray;
        overflow-x: hidden; /* Disable horizontal scroll */
        padding-top: 20px;
      }

      canvas { background:url(a014-colon-diagram.png) }

      table#info {
        margin: 1em auto;
        border-collapse: collapse;
        font-family: Arial, Helvetica, sans-serif;
      }

      #info th, #info td {
        padding: 4px 8px;
      }

      #info thead th {
        background: #4f81bd;
        text-transform: lowercase;
        text-align: left;
        font-size: 15px;
        color: #fff;
      }

      #info tr {
        border-right: 1px solid #95b3d7;
      }

      #info tbody tr {
        border-bottom: 1px solid #95b3d7;
      }

      #info tbody tr:nth-child(odd) {
        background: #dbe5f0;
      }

      #info tbody th, #info tbody tr:nth-child(even) td {
        border-right: 1px solid #95b3d7;
      }

      #info tfoot th {
        background: #4f81bd;
        text-align: left;
        font-weight: normal;
        font-size: 10px;
        color: #fff;
      }

      #info tr *:nth-child(3), #info tr *:nth-child(4) {
        text-align: right;
      }

      img, canvas { display: block; border: solid 1px; margin: 1em auto; }
    </style>

    <script>
      var samples = [
        { id: '001', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 12, width: 7, depth: 4, x: 309,  y: 371 },
        { id: '002', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 12, width: 6, depth: 2, x: 229,  y: 338 },
        { id: '003', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 8,  width: 4, depth: 1, x: 205,  y: 307 },
        { id: '004', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 11, width: 3, depth: 1, x: 257,  y: 362 },
        { id: '005', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 8,  width: 5, depth: 2, x: 244,  y: 342 },
        { id: '006', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 5,  width: 2, depth: 1, x: 166,  y: 357 },
        { id: '007', tissue_type: 'polyp',  phenotype: 'stalk',   location: 'Rectum',     length: 6,  width: 4, depth: 2, x: 70,   y: 357 },
        { id: '008', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 7,  width: 5, depth: 2, x: 131,  y: 309 },
        { id: '009', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 5,  width: 5, depth: 1, x: 144,  y: 408 },
        { id: '010', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 7,  width: 7, depth: 3, x: 109,  y: 392 },
        { id: '011', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 8,  width: 5, depth: 3, x: 135,  y: 327 },
        { id: '012', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 5,  width: 1, depth: 2, x: 113,  y: 314 },
        { id: '013', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 7,  width: 7, depth: 2, x: 519,  y: 373 },
        { id: '014', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 7,  width: 7, depth: 2, x: 403,  y: 394 },
        { id: '016', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 7,  width: 4, depth: 2, x: 551,  y: 392 },
        { id: '017', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 7,  width: 5, depth: 2, x: 458,  y: 323 },
        { id: '018', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 7,  width: 5, depth: 1, x: 371,  y: 394 },
        { id: '019', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 9,  width: 7, depth: 1, x: 224,  y: 312 },
        { id: '020', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 6,  width: 4, depth: 2, x: 187,  y: 305 },
        { id: '021', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 19, width: 5, depth: 2, x: 281,  y: 366 },
        { id: '022', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 6,  width: 3, depth: 1, x: 296,  y: 381 },
        { id: '023', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 5,  width: 4, depth: 2, x: 355,  y: 384 },
        { id: '024', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 8,  width: 5, depth: 2, x: 499,  y: 368 },
        { id: '025', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 4,  width: 3, depth: 2, x: 584,  y: 307 },
        { id: '026', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 8,  width: 7, depth: 5, x: 549,  y: 368 },
        { id: '027', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 5,  width: 5, depth: 3, x: 497,  y: 325 },
        { id: '028', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 6,  width: 4, depth: 2, x: 70,   y: 320 },
        { id: '029', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 5,  width: 4, depth: 2, x: 102,  y: 320 },
        { id: '030', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 4,  width: 3, depth: 2, x: 131,  y: 373 },
        { id: '031', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 10, width: 6, depth: 2, x: 168,  y: 294 },
        { id: '032', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 4,  width: 3, depth: 1, x: 155,  y: 307 },
        { id: '033', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 6,  width: 5, depth: 2, x: 94,   y: 342 },
        { id: '034', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 5,  width: 4, depth: 1, x: 122,  y: 384 },
        { id: '035', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 3,  width: 2, depth: 1, x: 150,  y: 388 },
        { id: '037', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 6,  width: 5, depth: 1, x: 196,  y: 364 },
        { id: '038', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Rectum',     length: 10, width: 7, depth: 2, x: 185,  y: 336 },
        { id: '039', tissue_type: 'Polyp',  phenotype: 'stalk',   location: 'Descending', length: 10, width: 5, depth: 2, x: 270,  y: 325 },
        { id: '040', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 10, width: 6, depth: 3, x: 268,  y: 379 },
        { id: '041', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 5,  width: 5, depth: 1, x: 323,  y: 364 },
        { id: '042', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 8,  width: 6, depth: 2, x: 414,  y: 340 },
        { id: '043', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 9,  width: 5, depth: 3, x: 338,  y: 388 },
        { id: '044', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 6,  width: 5, depth: 1, x: 394,  y: 412 },
        { id: '045', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 13, width: 8, depth: 2, x: 434,  y: 399 },
        { id: '046', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 4,  width: 3, depth: 1, x: 419,  y: 381 },
        { id: '047', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 5,  width: 4, depth: 3, x: 501,  y: 390 },
        { id: '048', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 5,  width: 3, depth: 2, x: 578,  y: 381 },
        { id: '049', tissue_type: 'Polyp',  phenotype: 'Stalk',   location: 'Descending', length: 4,  width: 3, depth: 1, x: 606,  y: 333 },
        { id: '050', tissue_type: 'Normal', phenotype: 'Stalk',   location: 'Descending', length: 5,  width: 5, depth: 2, x: 626,  y: 303 },
        { id: '051', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Descending', length: 22, width: 8, depth: 2, x: 303,  y: 333 },
        { id: '052', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Rectum',     length: 27, width: 5, depth: 2, x: 207,  y: 329 },
        { id: '053', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Descending', length: 25, width: 5, depth: 2, x: 329,  y: 353 },
        { id: '054', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Descending', length: 19, width: 5, depth: 2, x: 295,  y: 360 },
        { id: '055', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Descending', length: 36, width: 5, depth: 2, x: 386,  y: 373 },
        { id: '056', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Descending', length: 27, width: 6, depth: 2, x: 479,  y: 371 },
        { id: '101', tissue_type: 'Polyp',  phenotype: 'Sessile', location: 'Transverse', length: 9,  width: 3, depth: 2, x: 721,  y: 288 },
        { id: '102', tissue_type: 'Polyp',  phenotype: 'Sessile', location: 'Transverse', length: 4,  width: 4, depth: 2, x: 789,  y: 238 },
        { id: '103', tissue_type: 'Polyp',  phenotype: 'Sessile', location: 'Transverse', length: 5,  width: 3, depth: 2, x: 905,  y: 226 },
        { id: '104', tissue_type: 'Polyp',  phenotype: 'Sessile', location: 'Transverse', length: 5,  width: 3, depth: 3, x: 789,  y: 214 },
        { id: '105', tissue_type: 'Polyp',  phenotype: 'Sessile', location: 'Transverse', length: 5,  width: 3, depth: 2, x: 848,  y: 203 },
        { id: '106', tissue_type: 'Polyp',  phenotype: 'Sessile', location: 'Transverse', length: 3,  width: 2, depth: 1, x: 724,  y: 251 },
        { id: '107', tissue_type: 'Polyp',  phenotype: 'Sessile', location: 'Transverse', length: 5,  width: 3, depth: 3, x: 769,  y: 233 },
        { id: '108', tissue_type: 'Polyp',  phenotype: 'Sessile', location: 'Transverse', length: 7,  width: 3, depth: 2, x: 785,  y: 288 },
        { id: '109', tissue_type: 'Polyp',  phenotype: 'Sessile', location: 'Transverse', length: 6,  width: 4, depth: 2, x: 1005, y: 277 },
        { id: '110', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Transverse', length: 53, width: 7, depth: 2, x: 721,  y: 312 },
        { id: '111', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Transverse', length: 43, width: 6, depth: 2, x: 789,  y: 264 },
        { id: '112', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Transverse', length: 28, width: 7, depth: 2, x: 835,  y: 268 },
        { id: '113', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Transverse', length: 15, width: 8, depth: 3, x: 904,  y: 248 },
        { id: '114', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Transverse', length: 75, width: 6, depth: 1, x: 930,  y: 235 },
        { id: '115', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Transverse', length: 58, width: 5, depth: 2, x: 1146, y: 279 },
        { id: '201', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Ascending',  length: 51, width: 9, depth: 2, x: 1197, y: 296 },
        { id: '202', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Ascending',  length: 82, width: 5, depth: 1, x: 1245, y: 277 },
        { id: '203', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Ascending',  length: 65, width: 1, depth: 2, x: 1278, y: 300 },
        { id: '204', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Ascending',  length: 85, width: 6, depth: 1, x: 1303, y: 312 },
        { id: '205', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Ascending',  length: 73, width: 1, depth: 2, x: 1343, y: 331 },
        { id: '206', tissue_type: 'Normal', phenotype: 'Normal',  location: 'Ascending',  length: 38, width: 1, depth: 5, x: 1386, y: 349 } ];

      // Calculate size for each sample and average size for the set
      sum = 0;
      for (let i=0; i<samples.length; i++) {
        samples[i].size = samples[i].length * samples[i].width * samples[i].depth;
        samples[i].size_cat = samples[i].size < 50 ? 'small' : samples[i].size < 100 ? 'medium' : 'large';
        sum += samples[i].size;
        // Calculate the radius of the circle on the canvas by first calculating the volume of the
        // sample and then taking the cube root. This is not precisely accurate - it returns the length
        // of one side of a cube rather than the radius of a sphere, but the formula is much simpler and
        // sufficiently close to the spherical radius.
        samples[i].radius = Math.pow(samples[i].size, 1/3);
      }
      samples.avg_size = sum / samples.length;

      //// DISTANCE
      // Two-dimensional distance function, i.e. Pythagorean formula
      // Note that whatever objects are passed in must have fields "x" and "y"
      var dist = function(a, b) {
        return Math.sqrt( Math.pow((a.x - b.x), 2) + Math.pow((a.y - b.y), 2) );
      }

      // Create a distance matrix that we can use to calculate and store the distances between all
      // the points in advance so that they are easily displayed with a bit of hide/show code. It
      // will be a two-dimensional array with the distance between the i-th and j-th sample stored
      // at dist_mtx[i][j].
      var dist_mtx = []; 

      // Populate distance matrix with two-level for loop
      for (let i = 0; i < samples.length; i++) {
        dist_mtx[i] = [];
        for (let j = 0; j < samples.length; j++) {
          dist_mtx[i].push(dist(samples[i], samples[j]))
        }
      }

      // SELECTION LOGIC
      function filterSamples() {
        // Compare the attributes of the samples against the filtering criteria in the sidebar.
        // Logic that decides whether to draw or not draw sample.
        // Form: (... OR ... OR ...) AND (... OR ... OR ...) AND ... (... OR ... OR ...) AND ...
        // The reason for this logical form is that each sample should show up if
        // it matches any of the checkboxes within a group but only if each group
        // has at least one match
        for (let i=0; i<samples.length; i++) {
          samples[i].visible =
            // tissue type
            ( (samples[i].tissue_type.toLowerCase() === 'normal' && document.getElementById('tissue_type_normal').checked) ||
              (samples[i].tissue_type.toLowerCase() === 'polyp'  && document.getElementById('tissue_type_polyp').checked) ||
              (samples[i].tissue_type.toLowerCase() === 'adca'   && document.getElementById('tissue_type_adca').checked) )
            &&
            // size
            ( (samples[i].size_cat.toLowerCase() === 'small'  && document.getElementById('size_small').checked) ||
              (samples[i].size_cat.toLowerCase() === 'medium' && document.getElementById('size_medium').checked) ||
              (samples[i].size_cat.toLowerCase() === 'large'  && document.getElementById('size_large').checked) )
            &&
            // phenotype
            ( (samples[i].phenotype.toLowerCase() === 'normal'  && document.getElementById('phenotype_normal').checked) ||
              (samples[i].phenotype.toLowerCase() === 'sessile' && document.getElementById('phenotype_sessile').checked) ||
              (samples[i].phenotype.toLowerCase() === 'stalk'   && document.getElementById('phenotype_stalk').checked) )
            &&
            // location
            ( (samples[i].location.toLowerCase() === 'ascending'  && document.getElementById('location_ascending').checked) ||
              (samples[i].location.toLowerCase() === 'transverse' && document.getElementById('location_transverse').checked) ||
              (samples[i].location.toLowerCase() === 'descending' && document.getElementById('location_descending').checked) ||
              (samples[i].location.toLowerCase() === 'rectum'     && document.getElementById('location_rectum').checked) );
        }
      }

      // CANVAS
      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');

      function updateCanvas() {
        context.clearRect(0, 0, canvas.width, canvas.height);

        for (let i=0; i<samples.length; i++) {
          if (!samples[i].visible) continue;

          // Display pin
          context.beginPath();
          samples[i].pin = new Path2D();
          samples[i].pin.arc(samples[i].x, samples[i].y, samples[i].radius, 0, 2 * Math.PI);
          context.fillStyle = 'gray';
          context.fill(samples[i].pin);
           
          // Highlight the row in the table corresponding to sample when the mouse moves over it.
          // Note this event listener is attached to the canvas but carries with it certain variables
          // in scope when this block of code executes, e.g. i and samples[i].pin.
          canvas.addEventListener('mousemove', (e) => {
            if (context.isPointInPath(samples[i].pin, e.offsetX, e.offsetY)) {
              table_rows = document.querySelectorAll('#info > tr');
              for (let j=0; j<table_rows.length; j++) {
                if (Number(table_rows[j].children[0].innerHTML) === Number(samples[i].id)) {
                  // Highlight row corresponding to sample
                  table_rows[j].style.background = 'yellow';
                  table_rows[j].style.color = 'red';
                } else {
                  // Reset all other rows to default
                  table_rows[j].style.background = '';
                  table_rows[j].style.color = '';
                }

              }
            }
          });
        }
      }
      
    function updateTable() {
      table_rows = document.querySelectorAll('#info > tr');
      for (let i=0; i<table_rows.length; i++) {
        table_rows[i].remove();
      }

      for (let i=0; i<samples.length; i++) {
        if (!samples[i].visible) continue;

        table = document.getElementById('info');
        tr = document.createElement('tr');
        attrs = [ samples[i].id, samples[i].tissue_type, samples[i].size, samples[i].size_cat, samples[i].phenotype, samples[i].location ];
        for (let j=0; j<attrs.length; j++) {
          td = document.createElement('td');
          td.innerHTML = attrs[j];
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
    }

    // Event handling & canvas updating
    checkboxes = document.querySelectorAll('input[type="checkbox"]');
    for (let i=0; i<checkboxes.length; i++) {
      checkboxes[i].addEventListener('click', filterSamples);
      checkboxes[i].addEventListener('click', updateCanvas);
      checkboxes[i].addEventListener('click', updateTable);
    }

    window.addEventListener('load', filterSamples);
    window.addEventListener('load', updateCanvas);
    window.addEventListener('load', updateTable);

    </script> 
    <table id='info'>
      <thead> <tr> <th>Sample ID</th> <th>Tissue Type</th> <th>Size</th> <th>Size Category</th> <th>Phenotype</th> <th>Location</th> </tr> </thead>
      <tbody>
      </tbody>
      <tfoot> </tfoot>
    </table>
  </body>
</html>
